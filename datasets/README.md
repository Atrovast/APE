
# Detectron2 Builtin Datasets

Detectron2 has builtin support for a few datasets.

The datasets are assumed to exist in a directory specified by the environment variable
`DETECTRON2_DATASETS`.

Under this directory, following [here](https://github.com/facebookresearch/detectron2/blob/main/datasets/README.md) to prepare COCO, LVIS, cityscapes, Pascal VOC and ADE20k.

The expected structure is described below.
```
$DETECTRON2_DATASETS/
  coco/
  lvis/
  cityscapes/
  VOC20{07,10,12}/
  ADEChallengeData2016/
```

You can set the location for builtin datasets by `export DETECTRON2_DATASETS=/path/to/datasets`.
If left unset, the default is `./datasets` relative to your current working directory.


# APE Builtin Datasets


## Expected dataset structure for COCO and LVIS
```
$DETECTRON2_DATASETS/
  coco/
    annotations/
      instances_{train,val}2017.json
      panoptic_{train,val}2017.json
    {train,val}2017/
    panoptic_{train,val}2017/
    panoptic_stuff_{train,val}2017/
    panoptic_semseg_{train,val}2017/
  lvis/
    lvis_v1_{train,val}.json
    lvis_v1_{train,val}+coco_mask.json
    lvis_v1_{train,val}+coco_mask_cat_info.json
```


`panoptic_semseg_{train,val}2017/` are generated by runing
```
python3 datasets/prepare_coco_semantic_annos_from_panoptic_annos.py
```


`lvis_v1_{train,val}+coco_mask.json` are generated by running
```
python3 tools/lvis/merge_lvis_coco.py
```


`lvis_v1_{train,val}+coco_mask_cat_info.json` are generated by running
```
python3 tools/lvis/add_category_info_frequence.py --json_path datasets/lvis/lvis_v1_train+coco_mask.json
python3 tools/lvis/add_category_info_frequence.py --json_path datasets/lvis/lvis_v1_val+coco_mask.json
```




## Expected dataset structure for [Objects365](https://data.baai.ac.cn/details/Objects365_2020):
```
$DETECTRON2_DATASETS/
  objects365/
    annotations/
      zhiyuan_objv2_{train,val}.json
      objects365_{train,val,minival}_fixname.json
    train/
      images/
    val/
      images/
```

`objects365_train_fixname.json` and `objects365_val_fixname.json` are generated by running
```bash
python3 tools/objects3652coco/get_image_info.py --image_dir datasets/objects365/train/ --json_path datasets/objects365/annotations/zhiyuan_objv2_train.json --output_path datasets/objects365/annotations/image_info_train.txt
python3 tools/objects3652coco/get_image_info.py --image_dir datasets/objects365/val/ --json_path datasets/objects365/annotations/zhiyuan_objv2_val.json --output_path datasets/objects365/annotations/image_info_val.txt

python3 tools/objects3652coco/convert_annotations.py --root_dir datasets/objects365/ --image_info_path datasets/objects365/annotations/image_info_train.txt --subsets train --apply_exif
python3 tools/objects3652coco/convert_annotations.py --root_dir datasets/objects365/ --image_info_path datasets/objects365/annotations/image_info_val.txt --subsets val --apply_exif
python3 tools/objects3652coco/convert_annotations.py --root_dir datasets/objects365/ --image_info_path datasets/objects365/annotations/image_info_val.txt --subsets minival --apply_exif

python3 tools/objects3652coco/fix_o365_names.py --ann datasets/objects365/annotations/objects365_train.json
python3 tools/objects3652coco/fix_o365_names.py --ann datasets/objects365/annotations/objects365_val.json
python3 tools/objects3652coco/fix_o365_names.py --ann datasets/objects365/annotations/objects365_minival.json
```

As Objects365 is large, we generate annotation file for each image separetely
```
python3 tools/generate_img_ann_pair.py --json_path datasets/objects365/annotations/objects365_train_fixname.json --image_root datasets/objects365/train/
```

## Expected dataset structure for [OpenImages](https://storage.googleapis.com/openimages/web/download.html#download_manually):
```
$DETECTRON2_DATASETS/
  openimages/
    annotations/
      openimages_v6_{train,val}_bbox.json
      openimages_v6_{train,val}_bbox_nogroup.json
      openimages_v6_{train,val}_bbox_cat_info.json
      openimages_v6_{train,val}_bbox_nogroup_cat_info.json
    train/
    validation/
```

`openimages_v6_{train,val}_bbox.json` are generated by running
```
python3 tools/openimages2coco/convert_annotations.py --path datasets/openimages/ --version v6 --subset train --task bbox --apply-exif
python3 tools/openimages2coco/convert_annotations.py --path datasets/openimages/ --version v6 --subset val --task bbox --apply-exif
```

`openimages_v6_{train,val}_bbox_nogroup.json` are generated by running
```
python3 tools/openimages2coco/convert_annotations.py --path datasets/openimages/ --version v6 --subset train --task bbox --apply-exif --exclude-group
python3 tools/openimages2coco/convert_annotations.py --path datasets/openimages/ --version v6 --subset val --task bbox --apply-exif --exclude-group
```

`*_cat_info.json` are generated by running
```
python3 tools/lvis/add_category_info_frequence.py --json_path datasets/openimages/annotations/openimages_v6_train_bbox.json
python3 tools/lvis/add_category_info_frequence.py --json_path datasets/openimages/annotations/openimages_v6_val_bbox.json
python3 tools/lvis/add_category_info_frequence.py --json_path datasets/openimages/annotations/openimages_v6_train_bbox_nogroup.json
python3 tools/lvis/add_category_info_frequence.py --json_path datasets/openimages/annotations/openimages_v6_val_bbox_nogroup.json
```


## Expected dataset structure for [VisualGenome](https://homes.cs.washington.edu/~ranjay/visualgenome/api.html):
```
$DETECTRON2_DATASETS/
  visualgenome/
    VG_100K/
    VG_100K_2/
```

## Expected dataset structure for [SA-1B](https://ai.meta.com/datasets/segment-anything-downloads/):
```
$DETECTRON2_DATASETS/
  SA-1B/
    images/
    sam1b_instance.json
```

## Expected dataset structure for [RefCOCO]():
```
$DETECTRON2_DATASETS/
  SeqTR/
    mixed/
    refcocog-google/
    refcocog-umd/
    refcocoplus-unc/
```
Download the preprocessed json files from [here](https://github.com/seanzhuh/SeqTR#data-preparation)

## Expected dataset structure for [GQA](https://cs.stanford.edu/people/dorarad/gqa/download.html):
```
$DETECTRON2_DATASETS/
  gqa/
    images/
    gqa_region_train.json
```

## Expected dataset structure for [PhraseCut](https://github.com/ChenyunWu/PhraseCutDataset):
```
$DETECTRON2_DATASETS/
  phrasecut/
    images/
    phrasecut_train.json
```

## Expected dataset structure for [Flickr30k](https://shannon.cs.illinois.edu/DenotationGraph/):
```
$DETECTRON2_DATASETS/
  flickr30k/
    flickr30k-images/
    flickr30k_separateGT_train.json
```

## Expected dataset structure for [ODinW](https://github.com/microsoft/GLIP#the-object-detection-in-the-wild-benchmark):
```
$DETECTRON2_DATASETS/
  odinw/
```

## Expected dataset structure for [SegInW](https://github.com/microsoft/X-Decoder/tree/seginw#download):
```
$DETECTRON2_DATASETS/
  seginw/
```

## Expected dataset structure for [Roboflow100](https://github.com/roboflow/roboflow-100-benchmark#local-env):
```
$DETECTRON2_DATASETS/
  rf100/
```


## Expected dataset structure for [ADE20k-Full](https://groups.csail.mit.edu/vision/datasets/ADE20K/):
```
ADE20K_2021_17_01/
  images/
  images_detectron2/
  annotations_detectron2/
  index_ade20k.pkl
  objects.txt
```
The directories `images_detectron2` and `annotations_detectron2` are generated by running `python datasets/prepare_ade20k_full_sem_seg.py`.


## Expected dataset structure for [BDD10k](https://bdd-data.berkeley.edu/):
```
$DETECTRON2_DATASETS/
  bdd100k/
    images/
    labels/
    seg/
```

## Expected dataset structure for [PC459](https://cs.stanford.edu/~roozbeh/pascal-context/):
```
$DETECTRON2_DATASETS/
  VOCdevkit/
    VOC2010/
      annotations_detectron2/
        pc459_val/
```

## Expected dataset structure for [PC59](https://cs.stanford.edu/~roozbeh/pascal-context/):
```
$DETECTRON2_DATASETS/
  VOCdevkit/
    VOC2010/
      annotations_detectron2/
        pc59_val/
```

## Expected dataset structure for [VOC](http://host.robots.ox.ac.uk/pascal/VOC/voc2012/):
```
$DETECTRON2_DATASETS/
  VOCdevkit/
    VOC2012/
      annotations_detectron2/
        val/
```

## Expected dataset structure for [D3](https://github.com/shikras/d-cube#download):
```
$DETECTRON2_DATASETS/
  D3/
    d3_images/
    d3_json/
    d3_pkl/
```


